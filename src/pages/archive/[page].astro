---
import { getCollection } from "astro:content";
import BaseLayout from "../../layouts/BaseLayout.astro";
import PostCard from "../../components/PostCard.astro";
import Pagination from "../../components/Pagination.astro";
import type { BlogType } from "../../content.config";
import { formatDate } from "../../utils/formatDate";
import Year from "../../components/Year.astro";

const blogs = await getCollection("blogs");
const years = [
  ...new Set(
    blogs.map((blog: BlogType) => new Date(blog.data.date).getFullYear()),
  ),
];

export async function getStaticPaths({
  paginate,
}: {
  paginate: (data: BlogType[], options: { pageSize: number }) => unknown;
}) {
  const blogs = await getCollection("blogs");
  blogs.sort((a, b) => b.data.date.getTime() - a.data.date.getTime());

  return paginate(blogs, { pageSize: 8 });
}

const { page } = Astro.props as { page: { data: BlogType[] } };
---

<BaseLayout
  title="Archive | Rok Ajdnik"
  description="All blog posts"
  author="Rok Ajdnik"
  url="/archive"
>
  <section class="center">
    <Year years={years} />
    <div class="space-y-1">
      {
        page.data.map((blog: BlogType) => (
          <PostCard
            title={blog.data.title}
            date={formatDate(blog.data.date)}
            url={blog.data.slug}
            tags={blog.data.tags}
            cover={blog.data.cover}
          />
        ))
      }
    </div>
    <Pagination page={page} />
  </section>
</BaseLayout>
